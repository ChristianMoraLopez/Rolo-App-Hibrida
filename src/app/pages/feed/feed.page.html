<ion-content class="ion-padding">
  <!-- Search Bar -->
  <ion-searchbar
    [(ngModel)]="searchTerm"
    (ionInput)="onSearchChange()"
    (ionClear)="clearSearch()"
    placeholder="Buscar ubicaciones..."
  ></ion-searchbar>

  <!-- Create Post Form -->
  <ion-button expand="block" (click)="toggleCreatePost()" class="create-post-button">
    {{ showCreatePost ? 'Cancelar' : 'Crear nuevo post' }}
  </ion-button>

  <div *ngIf="showCreatePost" class="create-post-form">
    <ion-item>
      <ion-label position="stacked">Título</ion-label>
      <ion-input [(ngModel)]="newPost.title" placeholder="Título del post"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Contenido</ion-label>
      <ion-textarea [(ngModel)]="newPost.content" placeholder="¿Qué quieres compartir?"></ion-textarea>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Imagen</ion-label>
      <input type="file" accept="image/*" (change)="onImageSelected($event)" />
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Ubicación</ion-label>
      <ion-select [(ngModel)]="newPost.location" placeholder="Selecciona una ubicación">
        <ion-select-option *ngFor="let location of locations" [value]="location._id">
          {{ location.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-button expand="block" (click)="createPost()">Publicar</ion-button>
  </div>

  <!-- Posts List -->
  <ion-list *ngIf="!loading; else loadingTemplate">
    <ion-item *ngFor="let post of posts" class="post-item">
      <ion-label>
        <h2>{{ post.title }}</h2>
        <p>{{ truncateDescription(post.content) }}</p>
        <p class="post-meta">
          Por {{ getCreatorName(post.authorName) }} • {{ formatDate(post.createdAt) }}
          <br>
          Ubicación: {{ getLocationName(post.location) }}
        </p>
      <ion-button fill="clear" (click)="likePost(post._id)">
        <ion-icon [name]="post.liked ? 'heart' : 'heart-outline'"></ion-icon>
        {{ post.likes || 0 }}
      </ion-button>

      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Loading Template -->
  <ng-template #loadingTemplate>
    <ion-spinner name="crescent"></ion-spinner>
  </ng-template>

  <!-- Locations Map -->
  <app-google-map
    *ngIf="filteredLocations.length"
    [locations]="filteredLocations"
    (locationSelected)="onLocationSelected($event)"
  ></app-google-map>

  <!-- Footer -->
  <app-footer></app-footer>
</ion-content>