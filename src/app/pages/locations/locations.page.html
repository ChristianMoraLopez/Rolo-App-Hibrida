<ion-header>
  <ion-toolbar>
    <ion-title>Lugares</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="locations-content">
  <!-- Header Section -->
  <div class="header-section">
    <h1 class="page-title">Lugares Destacados</h1>
    <p class="page-subtitle">Explora los mejores lugares de la ciudad</p>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <ion-searchbar 
      placeholder="Buscar por nombre o descripción..."
      animated="true"
      (ionInput)="handleSearch($event)"
      class="custom-searchbar">
    </ion-searchbar>
  </div>

  <!-- Map Section -->
  <app-google-map
    *ngIf="filteredLocations.length && apiLoaded"
    [locations]="filteredLocations"
    (locationSelected)="onLocationSelected($event)"
    style="display: block; height: 400px; width: 100%;"
    class="map-container"
  ></app-google-map>
  <div class="map-error" *ngIf="apiLoadError">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>{{ apiLoadError }}</p>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando lugares...</p>
  </div>

  <!-- Locations Grid -->
  <div class="locations-grid" *ngIf="!isLoading && filteredLocations.length > 0">
    <ion-card *ngFor="let location of filteredLocations" class="location-card" (click)="selectLocation(location)">
      <!-- Image Header -->
      <div class="card-image-container">
        <img [src]="location.images && location.images[0]?.src || 'assets/placeholder.png'" [alt]="location.name">
        <div class="image-overlay"></div>
        <div class="location-name-overlay">
          <ion-icon name="location-outline"></ion-icon>
          <span>{{ location.name }}</span>
        </div>
      </div>

      <!-- Card Content -->
      <ion-card-content>
        <div class="location-meta">
          <span class="meta-item">
            <ion-icon name="location-outline"></ion-icon>
            {{ location.address || 'Bogotá' }}
          </span>
          <span class="meta-divider">•</span>
          <span class="meta-item">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ formatDate(location.createdAt) }}
          </span>
        </div>
        <p class="location-description">{{ truncateDescription(location.description) }}</p>
        
        <!-- Tags -->
        <div class="tags-container">
          <ion-chip *ngFor="let sensation of processArrayString(location.sensations)" class="sensation-chip">
            <ion-label>{{ sensation }}</ion-label>
          </ion-chip>
          <ion-chip *ngFor="let smell of processArrayString(location.smells)" class="smell-chip">
            <ion-label>{{ smell }}</ion-label>
          </ion-chip>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && filteredLocations.length === 0">
    <ion-icon name="search-outline"></ion-icon>
    <p>No se encontraron lugares que coincidan con la búsqueda</p>
  </div>

  <!-- FAB Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="createTestLocation()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>